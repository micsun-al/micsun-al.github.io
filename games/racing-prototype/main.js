(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{1673:function(e,t,s){"use strict";s.r(t);s(1674),s(752);var i=s(20);const n={ID:"main",IMAGE:"assets/sheets/main.png",DATA:"assets/sheets/main.json"},a={gotham_ultra_italic:{ID:"gotham_ultra_italic",IMAGE:"assets/fonts/gotham_ultra.png",DATA:"assets/fonts/gotham_ultra.fnt"}},r={audioVolume:{ID:"AUDIO_VOLUME",DEFAULT:.5},audioMute:{ID:"AUDIO_MUTE",DEFAULT:!1},playerLane:{ID:"PLAYER_LANE",DEFAULT:2},playerSpeed:{ID:"PLAYER_SPEED",DEFAULT:2},playerDistance:{ID:"PLAYER_DISTANCE",DEFAULT:.01},terrainTurn:{ID:"TERRAIN_TURN",DEFAULT:0},terrainFalloff:{ID:"TERRAIN_FALLOFF",DEFAULT:-.05},timeRemaining:{ID:"TIME_REMAINING",DEFAULT:6e4},playerScore:{ID:"PLAYER_SCORE",DEFAULT:0},playerStreak:{ID:"PLAYER_STREAK",DEFAULT:0},music:{ID:"MUSIC",DEFAULT:null}},h="MATERIALS_ALL_LOADED",o="REFLOW_REQUESTED",l="PLAYER_LEFT_REQUESTED",c="PLAYER_RIGHT_REQUESTED",d="PLAYER_CRASHED",p="PICKUP_MONEY_0",u="PICKUP_NITRO_0",m="SCORE_ADD",g="LOAD_PROGRESS",y="INPUT_LEFT",f="INPUT_RIGHT",w="INPUT_A",I="INPUT_B",b="SUMMARY_REPLAY_REQUESTED",E="REQUEST_MUSIC",S="REQUEST_SOUND",T="STOP_MUSIC",D=720,P=1280,M=1,v=3e3,O=5e3,x=1e3,A=1,_=2,R={ID:"boot"},L={ID:"loading"},B={ID:"intro"},k={ID:"main"},C={ID:"summary"},U={ID:"global"},N=[{ID:"oncoming_left",X:7.5},{ID:"oncoming_right",X:2.5},{ID:"left",X:-2.5},{ID:"right",X:-7.5}],F=10,G=-500,z=10,Q=1e3,q=3e3,X=-500,H=10,$=20,j={MAX_COUNT:1,RESPAWN_MIN:1e4,RESPAWN_MAX:2e4},V={MAX_COUNT:20,RESPAWN_MIN:1e3,RESPAWN_MAX:5e3},W={PREFIX:"T5TT8G#",request:e=>W.PREFIX+e},Y={truck:233,money:247,obstacle:239,tires:237,buildings:268,nitro:267};class J{constructor(e,t){this.id=e,this.path=t}}const K={intro:new J("music_intro",["assets/audio/danger-zone.mp3"]),game:new J("music_game",["assets/audio/danger-zone.mp3"]),summary:new J("music_summary",["assets/audio/danger-zone.mp3"])},Z={click:new J("sound_click",["assets/audio/click_0.mp3"]),crash0:new J("sound_crash_0",["assets/audio/crash_0.mp3"]),crash1:new J("sound_crash_1",["assets/audio/crash_1.mp3"]),engine:new J("sound_engine",["assets/audio/engine_0.mp3"]),jump:new J("sound_jump",["assets/audio/jump_0.mp3"]),money0:new J("sound_money_0",["assets/audio/money_0.mp3"]),money1:new J("sound_money_1",["assets/audio/money_1.mp3"]),money2:new J("sound_money_2",["assets/audio/money_2.mp3"]),nitro:new J("sound_nitro",["assets/audio/nitro_0.mp3"]),passing:new J("sound_passing",["assets/audio/passing_0.mp3"]),turn:new J("sound_turn",["assets/audio/turn_0.mp3"])};class ee extends i.Scene{constructor(){super({key:R.ID})}create(){this.scene.start(L.ID)}}class te{constructor(e){this.registry=e;for(let t in r)switch(r[t].ID){case r.audioMute.ID:let s="true"===localStorage.getItem(r[t].ID);null===s&&(s=r[t].DEFAULT),e.set(r[t].ID,s);break;case r.audioVolume.ID:let i=localStorage.getItem(r[t].ID);null===i&&(i=r[t].DEFAULT),e.set(r[t].ID,Phaser.Math.RoundTo(parseFloat(i),-2));break;default:e.set(r[t].ID,r[t].DEFAULT)}}}class se extends i.Scene{constructor(){super({key:L.ID})}init(){new te(this.registry)}preload(){let e;for(e in this.load.atlas(n.ID,n.IMAGE,n.DATA),K)this.load.audio(K[e].id,K[e].path);for(e in Z)this.load.audio(Z[e].id,Z[e].path);for(e in a){let t=a[e];this.load.bitmapFont(t.ID,t.IMAGE,t.DATA)}}create(){this.scene.start(B.ID),this.scene.launch(U.ID).bringToTop()}}function ie(e,t){Array.isArray(t)?t.forEach(t=>ie(e,t)):i.GameObjects.Container.prototype.isPrototypeOf(e)||Object.getPrototypeOf(e)instanceof i.GameObjects.Container?e.add(t):i.Scene.prototype.isPrototypeOf(e)||Object.getPrototypeOf(e)instanceof i.Scene?e.add.existing(t):console.log("ERROR: ALUtils.js: addAll: parent is not a PhaserScene or PhaserGameObjects.Container.")}function ne(e,t,s){e.registry.events.on(`changedata-${t}`,s),e.events.on("shutdown",()=>e.registry.events.off(`changedata-${t}`,s))}function ae(e,t,s){e.registry.events.on(t,s),e.events.on("shutdown",()=>e.registry.events.off(t,s))}class re extends i.GameObjects.Container{constructor(e,t=0,s=0){super(e,t,s),this.flag=e.add.image(0,0,n.ID,"shared/bg"),this.title=e.add.image(0,0,n.ID,"shared/title"),ie(this,[this.flag,this.title])}}class he extends i.GameObjects.Container{constructor(e,t=0,s=0){super(e,t,s),this.button=e.add.image(0,0,n.ID,"shared/play"),((e,t,s=1.05,n=null)=>{null===n&&(n=t.scale);let a=null;t.setInteractive({useHandCursor:!0});const r=()=>{a&&a.stop(),a=e.tweens.add({targets:t,duration:250,ease:i.Math.Easing.Bounce.Out,scale:{from:t.scale,to:n}})};t.on(i.Input.Events.POINTER_OVER,()=>{a&&a.stop(),a=e.tweens.add({targets:t,duration:250,ease:i.Math.Easing.Back.Out,scale:{from:t.scale,to:s}})}),t.on(i.Input.Events.POINTER_OUT,r),t.on(i.Input.Events.POINTER_UP,r),t.on(i.Input.Events.POINTER_UP_OUTSIDE,r)})(e,this.button),ie(this,[this.button])}}class oe extends i.Scene{constructor(){super({key:B.ID}),this.handlePlayClicked=(e,t)=>{this.playButton.button.input.enabled=!1,this.scene.start(k.ID)},this.handleReflow=()=>{this.containerCentered.setScale(this.cameras.main.height/P),this.containerCentered.setPosition(this.cameras.main.centerX,this.cameras.main.centerY)}}create(){ae(this,o,this.handleReflow),this.background=new re(this),this.playButton=new he(this,0,.275*P),this.playButton.button.on(i.Input.Events.POINTER_UP,this.handlePlayClicked),this.containerCentered=this.add.container(this.cameras.main.centerX,this.cameras.main.centerY,[this.background,this.playButton]),this.tweens.timeline({tweens:[{targets:this.background.flag,duration:500,ease:i.Math.Easing.Back.Out,props:{x:{start:100,to:0},alpha:{start:0,to:1}}},{offset:100,targets:this.background.title,duration:500,ease:i.Math.Easing.Back.Out,props:{x:{start:-100,to:0},alpha:{start:0,to:1}}},{offset:300,targets:this.playButton,duration:1e3,ease:i.Math.Easing.Quintic.Out,props:{y:{start:this.playButton.y+100,to:this.playButton.y},alpha:{start:0,to:1}}}]}),this.handleReflow()}}s(1672);var le=s(0),ce=s(99),de=s(45),pe=s(18);class ue{constructor(e,t=[]){this.engine=e,this.transformNode=new de.a("lights_transform_node",e.babylonScene),this.lights=[new ce.a("000_lights_hemispheric",new le.e(1,6,0),this.engine.babylonScene)];const s=this.lights[0];s.groundColor=pe.b.FromHexString("#1a3c45"),s.shadowEnabled=!0,s.intensity=1.4}}var me=s(5),ge=s(40),ye=s(90),fe=s(7);class we{constructor(e){this.engine=e,this.skybox=me.a.CreateBox("skyBox",1200,this.engine.babylonScene),this.skyboxMaterial=new ge.a("skyBox",this.engine.babylonScene),this.skyboxMaterial.backFaceCulling=!1,this.skyboxMaterial.disableLighting=!0,this.skybox.material=this.skyboxMaterial,this.skybox.infiniteDistance=!0,this.skyboxMaterial.reflectionTexture=new ye.a("assets/textures/skybox/skybox",this.engine.babylonScene),this.skyboxMaterial.reflectionTexture.coordinatesMode=fe.a.SKYBOX_MODE,this.skybox.renderingGroupId=0,this.engine.babylonScene.environmentTexture=this.skyboxMaterial.reflectionTexture}}var Ie=s(12),be=s(23),Ee=s(337);class Se{constructor(e,t=null){this.engine=e,this.target=t,this.camera=new Ee.a("follow-camera",new pe.h(Phaser.Utils.Array.GetRandom([-100,100]),20,-120),this.engine.babylonScene,t),this.camera.cameraAcceleration=.03,this.camera.maxCameraSpeed=3,this.engine.phaserScene.tweens.add({targets:this.camera,duration:3500,ease:Phaser.Math.Easing.Quadratic.InOut,rotationOffset:{start:-1.5,to:1.5},yoyo:!0,repeat:-1})}}class Te{constructor(e){this.engine=e,this.offsetBlocks=[],this.turnBlocks=[],this.falloffBlocks=[],this.addTarget=e=>{this.offsetBlocks.push(e.attachedBlocks.filter(e=>"Offset"===e.name)[0]),this.turnBlocks.push(e.attachedBlocks.filter(e=>"Turn"===e.name)[0]),this.falloffBlocks.push(e.attachedBlocks.filter(e=>"Horizon Falloff Rate"===e.name)[0])},this.handlePlayerDistance=(e,t,s)=>{this.offsetBlocks.forEach(e=>{e&&(e.value=t)})},this.handleTerrainTurn=(e,t,s)=>{this.turnBlocks.forEach(e=>{e&&(e.value=t)})},this.handleTerrainFalloff=(e,t,s)=>{this.falloffBlocks.forEach(e=>{e&&(e.value=t)})},this.engine=e,ne(this.engine.phaserScene,r.playerDistance.ID,this.handlePlayerDistance),ne(this.engine.phaserScene,r.terrainTurn.ID,this.handleTerrainTurn),ne(this.engine.phaserScene,r.terrainFalloff.ID,this.handleTerrainFalloff)}}class De extends class{constructor(e,t=6e4,s=[[0,0],[1,0]],i=[[0,-.05],[1,-.05]]){this.engine=e,this.duration=t,this.horizontal=s,this.vertical=i,this.currentTurn=0,this.currentFalloff=-.05,this.timeline=this.engine.phaserScene.tweens.createTimeline(),this.timeline.loop=-1,this.timeline.duration=this.duration,this.timeline.addListener(Phaser.Tweens.Events.TIMELINE_UPDATE,()=>{this.engine.phaserScene.registry.set(r.terrainTurn.ID,this.currentTurn),this.engine.phaserScene.registry.set(r.terrainFalloff.ID,this.currentFalloff)}),this.timeline.add({targets:this,duration:0,currentTurn:this.horizontal[0][1]});for(let e=1,t=this.horizontal.length;e<t;e++)this.timeline.add({targets:this,ease:Phaser.Math.Easing.Quadratic.InOut,duration:(this.horizontal[e][0]-this.horizontal[e-1][0])*this.duration,currentTurn:{from:this.horizontal[e-1][1],to:this.horizontal[e][1]}});this.timeline.add({offset:0,targets:this,duration:0,currentFalloff:this.vertical[0][1]});for(let e=1,t=this.vertical.length;e<t;e++)this.timeline.add({offset:this.duration*this.vertical[e][0],targets:this,ease:Phaser.Math.Easing.Quadratic.InOut,duration:(this.vertical[e][0]-this.vertical[e-1][0])*this.duration,currentFalloff:{from:this.vertical[e-1][1],to:this.vertical[e][1]}});this.timeline.play()}}{constructor(e,t=7e4){super(e,t,[[0,0],[.1,.15],[.2,-.15],[.3,0],[.4,.25],[.5,.15],[.6,-.15],[.7,0],[.8,-.25],[.9,.15],[1,0]],[[0,-.05],[.1,0],[.2,-.1],[.3,-.1],[.4,.1],[.5,0],[.6,-.2],[.7,-.1],[.8,.2],[.9,0],[1,-.05]])}}class Pe{constructor(e="",t="black"){this.loadingUIText=e,this.loadingUIBackgroundColor=t,this.displayLoadingUI=()=>{},this.hideLoadingUI=()=>{}}}var Me=s(267);class ve{constructor(e,t){this.running=!1,this.main=t,this.canvas=document.getElementById("babylon-canvas"),this.engine=new Ie.a(this.canvas,!0,{stencil:!0}),this.engine.loadingScreen=new Pe,this.phaserScene=e,this.babylonScene=new be.a(this.engine),this.babylonScene.fogMode=be.a.FOGMODE_LINEAR,this.babylonScene.fogStart=300,this.babylonScene.fogEnd=620,this.babylonScene.fogColor=pe.b.FromHexString("#619195"),this.babylonScene.ambientColor.set(.95,.49,.52),this.camera=new Se(this),this.pipeline=new Me.a("defaultPipeline",!0,this.babylonScene,[this.camera.camera]),this.pipeline.imageProcessingEnabled=!0,this.pipeline.imageProcessing.vignetteEnabled=!0,this.pipeline.fxaaEnabled=!0,this.pipeline.depthOfFieldEnabled=!0,this.pipeline.depthOfField.focusDistance=15e3,this.pipeline.depthOfFieldBlurLevel=Me.b.High,this.pipeline.depthOfField.focalLength=80,this.pipeline.depthOfField.fStop=1.7,this.pipeline.depthOfField.lensSize=50,new Me.c(this.babylonScene,Me.d.HighDegradationAllowed()).start(),this.meshWarper=new Te(this),ae(e,o,()=>{this.handleResizeEvent()}),new De(this),this.handleResizeEvent()}handleResizeEvent(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.engine.resize()}runRenderLoop(){this.engine.runRenderLoop(this.render.bind(this))}render(){this.running&&this.babylonScene.render()}}var Oe=s(39);class xe extends de.a{constructor(e){super("main3d-player",e.babylonScene),this.engine=e,this.init=async()=>{const e=["armored-wheel-back-left","armored-wheel-back-right","armored-wheel-front-left","armored-wheel-front-right"];return await new Promise(t=>{Oe.a.Append("assets/models/","armored.glb",this.engine.babylonScene,s=>{this.mesh=s.getMeshByID("armored-mesh"),this.mesh.registerInstancedBuffer("instanceColor",3),this.mesh.instancedBuffers.color=new pe.b(1,i.Math.Between(.5,1),i.Math.Between(.5,1)),this.mesh.parent=this,this.mesh.rotationQuaternion=null,this.mesh.material=this.engine.main.materials.truck,e.forEach(e=>{let t=s.getMeshByID(e);t.parent=this,t.material=this.engine.main.materials.tires}),t()})}).then(()=>{ne(this.engine.phaserScene,r.playerLane.ID,this.handlePlayerLaneChanged),ae(this.engine.phaserScene,l,this.requestLeft),ae(this.engine.phaserScene,c,this.requestRight),ae(this.engine.phaserScene,d,this.handlePlayerCrashed),this.engine.phaserScene.registry.set(r.playerLane.ID,3),this.engine.phaserScene.time.addEvent({delay:500,callback:()=>{this.engine.phaserScene.registry.set(r.playerLane.ID,r.playerLane.DEFAULT)}})})},this.handlePlayerLaneChanged=(e,t,s)=>{if(t===s)return;this.translateTimeline&&this.translateTimeline.isPlaying&&this.translateTimeline.stop(),this.translateTimeline=this.engine.phaserScene.tweens.timeline({targets:this.position,ease:Phaser.Math.Easing.Quadratic.InOut,tweens:[{props:{x:{start:this.position.x,to:N[this.engine.phaserScene.registry.get(r.playerLane.ID)].X}},duration:500}]}),this.rotationTimeline&&this.rotationTimeline.isPlaying&&this.rotationTimeline.stop();const i=(t<s?-.12:.12)+Math.PI;this.rotationTimeline=this.engine.phaserScene.tweens.timeline({targets:this.rotation,tweens:[{ease:Phaser.Math.Easing.Quadratic.InOut,duration:250,y:{start:this.rotation.y,to:i}},{ease:Phaser.Math.Easing.Quadratic.InOut,offset:300,duration:600,y:{from:i,to:Math.PI}}],onComplete:()=>{this.rotationTimeline=null}})},this.requestLeft=()=>{this.engine.phaserScene.registry.events.emit(S,Z.turn.id),this.engine.phaserScene.registry.set(r.playerLane.ID,Phaser.Math.Clamp(this.engine.phaserScene.registry.get(r.playerLane.ID)-1,0,N.length-1))},this.requestRight=()=>{this.engine.phaserScene.registry.events.emit(S,Z.turn.id),this.engine.phaserScene.registry.set(r.playerLane.ID,Phaser.Math.Clamp(this.engine.phaserScene.registry.get(r.playerLane.ID)+1,0,N.length-1))},this.handlePlayerCrashed=()=>{if(this.crashTimeline&&this.crashTimeline.isPlaying())return;this.crashTimeline=this.engine.phaserScene.tweens.timeline({onComplete:()=>{this.crashTimeline=null,this.rotation.y=Math.PI},tweens:[{targets:[this.rotation],duration:500,ease:Phaser.Math.Easing.Back.Out,props:{y:{start:0,to:Math.PI*Phaser.Utils.Array.GetRandom([-2,2])}}},{offset:0,targets:[this.rotation],duration:500,ease:Phaser.Math.Easing.Bounce.Out,props:{z:{start:0,to:Math.PI*Phaser.Utils.Array.GetRandom([-2,2])}}},{offset:0,targets:[this.rotation],duration:400,ease:Phaser.Math.Easing.Bounce.Out,props:{x:{from:0,to:2*Math.PI}}},{offset:0,targets:[this.position],duration:125,ease:Phaser.Math.Easing.Quadratic.Out,props:{y:{start:this.position.y,to:this.position.y+5}}},{offset:125,duration:125,targets:[this.position],ease:Phaser.Math.Easing.Quadratic.In,props:{y:{from:this.position.y+5,to:this.position.y+2.5}}},{offset:250,duration:250,targets:[this.position],ease:Phaser.Math.Easing.Bounce.Out,props:{y:{from:this.position.y+2.5,to:0}}}]})},this.cameraTarget=new me.a("camera-target",e.babylonScene,this),this.cameraTarget.position.y=4,this.engine.camera.camera.lockedTarget=this.cameraTarget,this.rotationQuaternion=null,this.rotation.y=Math.PI}}class Ae extends de.a{constructor(e){super("terrain",e.babylonScene),this.engine=e,this.allMeshes=[],this.init=async()=>{const e=await Promise.all([Oe.a.AppendAsync("assets/models/","flat.glb",this.engine.babylonScene),Oe.a.AppendAsync("assets/models/","buildings.glb",this.engine.babylonScene),Oe.a.AppendAsync("assets/models/","overpass.glb",this.engine.babylonScene)]);let t;for(this.terrains=[e[0].getMeshByID("flat-00"),e[1].getMeshByID("buildings-00"),e[2].getMeshByID("overpass-00")],this.terrains.forEach(e=>{e.position.set(0,0,90),e.material=this.engine.main.materials.buildings,e.parent.name=`_prefab-${e.name}`}),t=-2;t<15;t++)this.instantiate(t,0);for(t=15;t<200;t++)this.instantiate(t);for(t=200;t<220;t++)this.instantiate(t,0)},this.instantiate=(e,t=null)=>{const s=(null===t?i.Utils.Array.GetRandom(this.terrains):this.terrains[t]).instantiateHierarchy(this);s.position.set(0,0,-40*e),s.rotationQuaternion=null,s.rotation.set(0,0,0),s.parent=this,s.setEnabled(!0)},this.engine=e}}class _e extends de.a{constructor(e,t){super("main3d-obstacle",t.babylonScene),this.name=e,this.engine=t,this.init=async()=>new Promise(async e=>{const t=await Oe.a.AppendAsync("assets/models/","obstacle.glb");this.body=t.getMeshByName("obstacle-mesh"),this.body.name=this.name,this.body.material=this.engine.main.materials.obstacle;const s=this.body.parent;this.body.setParent(this),s.dispose(),e()})}}class Re{constructor(e){this.engine=e,this.available=[],this.active=[],this.init=async()=>{for(let e=0;e<F;e++){let t=new _e(`obstacle-${e}`,this.engine);await t.init().then(()=>{t.setEnabled(!1),this.available.push(t)})}}}requestSpawn(e=-1){if(this.available.length<=0)return void console.log("Main3DObstaclePool.ts: requestSpawn: NO MORE OBSTACLES AVAILABLE IN THE POOL!");-1===e&&(e=Phaser.Math.Between(0,N.length-1));const t=this.available.pop();this.active.push(t),t.rotation.set(0,Math.PI,0),t.position.set(N[e].X,0,G),t.setEnabled(!0),t.timeline&&t.timeline.isPlaying()&&t.timeline.stop(),t.timeline=this.engine.phaserScene.tweens.timeline({targets:[t.position],tweens:[{duration:Phaser.Math.Between(6e3,8e3),ease:Phaser.Math.Easing.Linear.Linear,props:{z:{from:t.position.z,to:z}}}],onComplete:()=>{t.setEnabled(!1),this.active.splice(this.active.indexOf(t),1),this.available.push(t)}})}}class Le{constructor(e){this.handleLeft=e=>{this.engine.phaserScene.registry.events.emit(l)},this.handleRight=e=>{this.engine.phaserScene.registry.events.emit(c)},this.handleUp=e=>{this.engine.phaserScene.registry.events.emit(I)},this.handleDown=e=>{this.engine.phaserScene.registry.events.emit(w)},this.handlePointerDown=(e,t)=>{this.engine.phaserScene.registry.events.emit(this.engine.phaserScene.input.x<this.engine.phaserScene.cameras.main.centerX?l:c)},this.engine=e,["LEFT","A"].forEach(e=>this.addInput(e,this.handleLeft)),["RIGHT","D"].forEach(e=>this.addInput(e,this.handleRight)),["UP","W","SPACE","SHIFT"].forEach(e=>this.addInput(e,this.handleUp)),["DOWN","S","X","CTRL"].forEach(e=>this.addInput(e,this.handleDown)),e.phaserScene.input.on(Phaser.Input.Events.POINTER_DOWN,this.handlePointerDown)}addInput(e,t){this.engine.phaserScene.input.keyboard.on(`keydown-${e}`,t)}}var Be=s(344);class ke{constructor(e){this.engine=e,this.init=async()=>{const e=[];for(let t in Y)e.push(this.loadMaterial(Y[t],t));return await Promise.all(e).then(()=>{this.engine.phaserScene.registry.events.emit(h)})},this.loadMaterial=(e,t)=>new Promise(s=>{Be.a.ParseFromSnippetAsync(W.request(e),this.engine.babylonScene,"assets/models/").then(e=>{e.optimize(),this[t]=e,this.engine.meshWarper.addTarget(e),s()})})}}class Ce extends de.a{constructor(e,t,s,i){super(e,t),this.originalMesh=s,this.setEnabled(!1),this.mesh=s.clone(e,this),this.mesh.material=i,this.mesh.rotationQuaternion=null}}class Ue extends Ce{constructor(e,t,s){super(`transform-${e}`,t.babylonScene,s,t.main.materials.money),this.name=e,this.engine=t;const n=i.Math.Between(3e3,1e4),a=i.Math.FloatBetween(.1,.4);this.engine.phaserScene.tweens.timeline({loop:-1,tweens:[{offset:0,targets:this.mesh.rotation,duration:n,props:{y:{from:0,to:Math.PI*Phaser.Utils.Array.GetRandom([-2,2])}}}]}),this.engine.phaserScene.tweens.timeline({loop:-1,tweens:[{offset:0,targets:this.mesh.position,duration:.5*n,yoyo:!0,repeat:1,props:{y:{from:-a,to:a}}}]})}}class Ne{constructor(e,t,s,i,n){this.engine=e,this.pickupEvent=t,this.modelGlb=s,this.meshID=i,this.itemCount=n,this.available=[],this.active=[]}}class Fe extends Ne{constructor(e){super(e,p,"powerup","powerup-mesh",V.MAX_COUNT),this.engine=e,this.init=async()=>{ae(this.engine.phaserScene,this.pickupEvent,this.handlePickup);const e=(await Oe.a.AppendAsync("assets/models/",`${this.modelGlb}.glb`,this.engine.babylonScene)).getMeshByID(this.meshID);for(let t=0;t<this.itemCount;t++)this.available.push(new Ue(`${this.modelGlb}-${t}`,this.engine,e));e.parent.dispose(),e.dispose(),ae(this.engine.phaserScene,this.pickupEvent,this.handlePickup)},this.requestSpawn=(e=-1)=>{if(this.available.length<1)return void console.log("Main3DItemPoolMoney.ts: requestSpawn: NO MORE MONEYBAGS AVAILABLE IN POOL!");-1===e&&(e=Phaser.Math.Between(0,N.length-1));const t=this.available.pop();this.active.push(t),t.position.set(N[e].X,0,X),t.setEnabled(!0),t.movementTimeline=this.engine.phaserScene.tweens.timeline({targets:t.position,tweens:[{offset:0,duration:Phaser.Math.Between(5e3,8e3),ease:Phaser.Math.Easing.Linear.Linear,props:{z:{from:t.position.z,to:H}}}],onComplete:()=>{t.setEnabled(!1),this.available.push(this.active.splice(this.active.indexOf(t),1)[0])}})},this.handlePickup=(e,t)=>{const s=this.active.indexOf(e);s<0||(e.movementTimeline&&e.movementTimeline.isPlaying&&(e.movementTimeline.stop(),e.movementTimeline=null),e.setEnabled(!1),this.engine.phaserScene.registry.events.emit(m,t),this.available.push(this.active.splice(s,1)[0]))}}}class Ge extends Ce{constructor(e,t,s){super(`transform-${e}`,t.babylonScene,s,t.main.materials.nitro),this.name=e,this.engine=t;const n=i.Math.Between(3e3,1e4),a=i.Math.FloatBetween(.1,.4);this.engine.phaserScene.tweens.timeline({loop:-1,tweens:[{offset:0,targets:this.mesh.rotation,duration:n,props:{y:{from:0,to:Math.PI*Phaser.Utils.Array.GetRandom([-2,2])}}}]}),this.engine.phaserScene.tweens.timeline({loop:-1,tweens:[{offset:0,targets:this.mesh.position,duration:.5*n,yoyo:!0,repeat:1,props:{y:{from:-a,to:a}}}]})}}class ze extends Ne{constructor(e){super(e,u,"nitro","nitro-mesh",j.MAX_COUNT),this.engine=e,this.init=async()=>{ae(this.engine.phaserScene,this.pickupEvent,this.handlePickup);const e=(await Oe.a.AppendAsync("assets/models/",`${this.modelGlb}.glb`,this.engine.babylonScene)).getMeshByID(this.meshID);for(let t=0;t<this.itemCount;t++)this.available.push(new Ge(`${this.modelGlb}-${t}`,this.engine,e));e.parent.dispose(),e.dispose()},this.requestSpawn=(e=-1)=>{if(this.available.length<1)return void console.log("Main3DPoolNitro.ts: requestSpawn: NO MORE NITRO AVAILABLE IN POOL!");-1===e&&(e=Phaser.Math.Between(0,N.length-1));const t=this.available.pop();this.active.push(t),t.position.set(N[e].X,0,X),t.setEnabled(!0),t.movementTimeline=this.engine.phaserScene.tweens.timeline({targets:t.position,tweens:[{offset:0,duration:Phaser.Math.Between(5e3,8e3),ease:Phaser.Math.Easing.Linear.Linear,props:{z:{from:t.position.z,to:H}}}],onComplete:()=>{t.setEnabled(!1),this.available.push(this.active.splice(this.active.indexOf(t),1)[0])}})},this.handlePickup=(e,t)=>{console.log("Main3DPoolNitro.ts: handlePickup: nitro:",e,", this.active:",this.active);const s=this.active.indexOf(e);s<0||(e.movementTimeline&&e.movementTimeline.isPlaying&&(e.movementTimeline.stop(),e.movementTimeline=null),e.setEnabled(!1),this.available.push(this.active.splice(s,1)[0]))}}}class Qe{constructor(e){this.handleSummaryReplayRequested=()=>{this.engine.engine.dispose()},this.loadAssets=async()=>{this.skybox=new we(this.engine),this.engine.running=!0,this.lights=new ue(this.engine),this.engine.lightsTransformNode=this.lights.transformNode,this.player=new xe(this.engine),this.terrain=new Ae(this.engine),this.obstacles=new Re(this.engine),this.itemPoolMoney=new Fe(this.engine),this.itemPoolNitro=new ze(this.engine),this.engine.runRenderLoop(),this.commonInput=new Le(this.engine),this.materials=new ke(this.engine),await this.materials.init(),this.handleProgress(.25,1,5),window.engine=this.engine,window.scene=this.engine.babylonScene,await this.allProgress([this.player.init(),this.terrain.init(),this.obstacles.init(),this.itemPoolMoney.init(),this.itemPoolNitro.init()],this.handleProgress),ne(this.engine.phaserScene,r.playerSpeed.ID,this.handleSpeedChanged)},this.handleProgress=(e,t,s)=>{this.engine.phaserScene.registry.events.emit(g,e,t,s)},this.initScene=async()=>{},this.handleLoaded=e=>{},this.allProgress=(e,t)=>{const s=e.length||0;let i=0;return t(i),e.forEach(e=>{e.then(()=>{t(++i/s,i,s)})}),Promise.all(e)},this.handleSpeedChanged=(e,t)=>{let s=t/A;this.obstacles.active.forEach(e=>{e.timeline&&e.timeline.isPlaying()&&(e.timeline.timeScale=s<1?-1:s)}),this.itemPoolMoney.active.forEach(e=>{e.movementTimeline&&e.movementTimeline.isPlaying()&&(e.movementTimeline.timeScale=s)}),this.itemPoolNitro.active.forEach(e=>{e.movementTimeline&&e.movementTimeline.isPlaying()&&(e.movementTimeline.timeScale=s)})},this.phaserScene=e,this.engine=new ve(e,this),this.phaserScene.registry.events.once(b,this.handleSummaryReplayRequested)}}class qe extends i.GameObjects.Image{constructor(e){super(e,0,0,n.ID,"game/crash"),this.handleCrashed=()=>{this.crashTimeline&&this.crashTimeline.isPlaying||(this.angle=i.Math.Between(-10,10),this.crashTimeline=this.scene.tweens.timeline({targets:this,onComplete:()=>{this.crashTimeline=null},tweens:[{duration:200,ease:i.Math.Easing.Quintic.Out,props:{alpha:{start:0,to:1}}},{offset:0,duration:400,ease:i.Math.Easing.Elastic.Out,easeParams:[5],props:{scale:{start:.8,to:1}}},{offset:300,duration:350,ease:i.Math.Easing.Quadratic.In,props:{alpha:{from:1,to:0}}}]}))},this.alpha=0,ae(e,d,this.handleCrashed)}}class Xe extends i.GameObjects.Container{constructor(e){super(e)}}class He extends i.GameObjects.Container{constructor(e,t=0,s=0){super(e,t,s),this.text=e.make.bitmapText({text:"",font:a.gotham_ultra_italic.ID,size:64}).setOrigin(.5).setTint(16776960).setCenterAlign(),this.add(this.text)}}class $e extends i.GameObjects.Container{constructor(e,t=0,s=0){super(e,t,s),this.availablePool=[],this.requestBurst=(e=0,t=null,s=null)=>{if(this.availablePool.length<=0)return void console.log("MainUiScoreFloaterPool.ts: requestBurst: Ran out of score floaters, maybe increase the max...");const n=this.availablePool.pop();n.text.text=`+$${e.toLocaleString()}`,t&&(n.text.text=`${t}\n${n.text.text}`),s&&(n.text.text=`${n.text.text}\n${s}`),n.text.setTint(i.Utils.Array.GetRandom([3341079,1571714,1571795,1557499,1542139])),n.alpha=0,n.visible=!0;const a=i.Math.Between(450,700);this.scene.tweens.timeline({targets:n,tweens:[{duration:a,ease:i.Utils.Array.GetRandom([i.Math.Easing.Quadratic.Out,i.Math.Easing.Quintic.Out]),props:{x:{start:0,to:i.Math.Between(-50,50)}}},{offset:0,duration:.9*a,ease:i.Utils.Array.GetRandom([i.Math.Easing.Quadratic.Out,i.Math.Easing.Quintic.Out,i.Math.Easing.Back.Out]),props:{y:{start:0,to:i.Math.Between(-150,-250)}}},{offset:0,duration:.35*a,ease:i.Math.Easing.Quadratic.InOut,props:{alpha:{start:0,to:1}}},{offset:.7*a,duration:.3*a,ease:i.Math.Easing.Quadratic.InOut,props:{alpha:{from:1,to:0}}}],onComplete:()=>{this.availablePool.push(n),n.visible=!1,n.alpha=0}})};for(let t=0;t<$;t++){let t=new He(e);t.alpha=0,t.visible=!1,this.add(t),this.availablePool.push(t)}}}class je extends i.GameObjects.Container{constructor(e,t=0,s=0){super(e,t,s),this.targetValue=0,this.handleLoadIncrement=(e,t,s)=>{this.targetValueTween&&this.targetValueTween.isPlaying&&this.targetValueTween.stop(),this.targetValueTween=this.scene.tweens.add({targets:this,duration:1e4,ease:i.Math.Easing.Quadratic.InOut,targetValue:{start:this.targetValue,to:e},onUpdate:()=>{this.requestText(this.targetValue)}})},this.requestText=(e=0)=>{this.text.text=`Loading...\n${(100*e).toFixed(0)}%`},this.requestCompleted=()=>{this.targetValueTween.stop(),this.scene.tweens.timeline({targets:this,tweens:[{duration:150,ease:i.Math.Easing.Quintic.Out,props:{targetValue:1}},{duration:1500,ease:i.Math.Easing.Quadratic.InOut,props:{alpha:0}}],onUpdate:()=>{this.requestText(this.targetValue)},onComplete:()=>{this.destroy()}})},this.bg=e.add.graphics(),this.bg.fillStyle(0,1),this.bg.fillRect(-1e4,-1e4,2e4,2e4),this.text=e.add.bitmapText(0,0,a.gotham_ultra_italic.ID,"Loading...",72,1).setOrigin(.5),ie(this,[this.bg,this.text]),ae(e,g,this.handleLoadIncrement)}}class Ve extends i.GameObjects.Container{constructor(e,t=0,s=0){super(e,t,s),this.handleScoreUpdated=()=>{this.titleText.text=`MULTIPLIER x${(1+~~this.scene.registry.get(r.playerStreak.ID)).toLocaleString()}`,this.scoreText.text=`$${(~~this.scene.registry.get(r.playerScore.ID)).toLocaleString()}`};this.titleText=e.make.bitmapText({text:"SCORE",size:46,font:a.gotham_ultra_italic.ID,x:-295,y:35,origin:{x:0,y:.5}}).setTint(16440601),this.scoreText=e.make.bitmapText({text:"0",size:64,font:a.gotham_ultra_italic.ID,x:-300,y:90,origin:{x:0,y:.5}}),ie(this,[this.titleText,this.scoreText]),ne(e,r.playerScore.ID,this.handleScoreUpdated)}}class We extends i.GameObjects.Container{constructor(e,t=0,s=0){super(e,t,s),this.handleTimeUpdated=(e,t)=>{this.timeText.text=`${~~(t/1e3)}`};this.timeTitle=e.make.bitmapText({x:305,y:35,text:"TIME:",font:a.gotham_ultra_italic.ID,origin:{x:1,y:.5},size:46}).setTint(16440601),this.timeText=e.make.bitmapText({x:300,y:90,text:"60",font:a.gotham_ultra_italic.ID,origin:{x:1,y:.5},size:64}),this.add([this.timeTitle,this.timeText]),ne(e,r.timeRemaining.ID,this.handleTimeUpdated)}}class Ye extends i.GameObjects.Container{constructor(e,t,s=0,r=0,h="",o=16777215,l=0,c=0,d=.5,p=1,u=64,m=Phaser.GameObjects.BitmapText.ALIGN_CENTER){super(e,s,r),this.event=t,this.alphaMin=d,this.alphaMax=p,this.isDown=!1,this.handlePointerOver=()=>{this.scene.tweens.add({targets:this,duration:250,ease:i.Math.Easing.Quadratic.InOut,props:{alpha:this.alphaMax}})},this.handlePointerOut=()=>{this.scene.tweens.add({targets:this,duration:250,ease:i.Math.Easing.Quadratic.InOut,props:{alpha:this.alphaMin}})},this.handlePointerDown=(e,t,s,i)=>{i&&i.stopPropagation&&i.stopPropagation(),this.setButtonDown(!0)},this.handlePointerUp=(e,t,s,i)=>{i&&i.stopPropagation&&i.stopPropagation(),this.isDown&&this.scene.registry.events.emit(this.event),this.setButtonDown(!1)},this.setButtonDown=e=>{this.isDown=e,this.buttonUp.alpha=e?.01:1,this.buttonDown.alpha=e?1:.01},this.buttonUp=e.add.image(0,0,n.ID,"game/button_up"),this.buttonDown=e.add.image(0,0,n.ID,"game/button_down"),this.textField=e.add.bitmapText(l,c,a.gotham_ultra_italic.ID,h,u,m).setOrigin(.5),this.add([this.buttonUp,this.buttonDown,this.textField]),this.setButtonDown(!1),this.buttonDown.setInteractive({useHandCursor:!0}),this.buttonDown.on(i.Input.Events.POINTER_OVER,this.handlePointerOver),this.buttonDown.on(i.Input.Events.POINTER_OUT,this.handlePointerOut),this.buttonDown.on(i.Input.Events.POINTER_DOWN,this.handlePointerDown),this.buttonDown.on(i.Input.Events.POINTER_UP,this.handlePointerUp),this.buttonDown.on(i.Input.Events.POINTER_UP_OUTSIDE,this.handlePointerUp),i.Actions.SetTint([this.buttonDown,this.buttonUp],o)}}class Je extends i.GameObjects.Container{constructor(e,t=0,s=0){super(e,t,s),this.left=new Ye(e,y,-.2*P,0,"<",16711680,-5),this.right=new Ye(e,f,.2*P,0,">",16711680,-3),this.buttonB=new Ye(e,w,0,-.2*P,"PEW",65280,-3,0,.5,1,50).setVisible(!1),this.buttonA=new Ye(e,I,0,0,"JUMP",16776960,-5,0,.5,1,50);const n=[this.left,this.right,this.buttonA,this.buttonB];this.add(n),i.Actions.SetAlpha(n,.5)}}const Ke={nitro:"NITRO!"};class Ze extends i.Scene{constructor(){super({key:k.ID}),this.dirty=!1,this.speed=0,this.distance=0,this.score=0,this.allLoaded=!1,this.powerupStreak=0,this.JUMP_DURATION=1e3,this.JUMP_SAFE_TIME=600,this.JUMP_HEIGHT=5,this.isJumping=!1,this.isSafe=!1,this.handleAllLoaded=()=>{this.registry.set(r.playerDistance.ID,r.playerDistance.DEFAULT),this.registry.set(r.timeRemaining.ID,r.timeRemaining.DEFAULT),this.registry.set(r.playerScore.ID,r.playerScore.DEFAULT),this.registry.set(r.playerLane.ID,r.playerLane.DEFAULT),this.registry.set(r.playerSpeed.ID,r.playerSpeed.DEFAULT),this.registry.set(r.playerStreak.ID,r.playerStreak.DEFAULT),this.score=0,this.distance=0,this.speed=0,this.scoreDisplay=new Ve(this),this.timeDisplay=new We(this),this.crashEffect=new qe(this),this.uiTimer=new Xe(this),this.controls=new Je(this,0,-.1*P),this.scoreFloaterPool=new $e(this,0,.25*this.cameras.main.height),ie(this.containerCentered,[this.crashEffect,this.uiTimer,this.scoreFloaterPool]),ie(this.containerTopCenter,[this.scoreDisplay,this.timeDisplay]),ie(this.containerBottomCenter,[this.controls]),ae(this,p,this.handlePickupMoney),ae(this,u,this.handlePickupNitro),ae(this,y,this.handleInputLeft),ae(this,f,this.handleInputRight),ae(this,w,this.requestShoot),ae(this,I,this.requestJump),ae(this,d,this.handlePlayerCrashed),ne(this,r.playerSpeed.ID,(e,t)=>{this.speed=t}),this.time.addEvent({delay:i.Math.Between(Q,q),callback:this.spawnObstacleLoop}),this.time.addEvent({delay:i.Math.Between(V.RESPAWN_MIN,V.RESPAWN_MAX),callback:this.spawnMoneyLoop}),this.time.addEvent({delay:i.Math.Between(j.RESPAWN_MIN,j.RESPAWN_MAX),callback:this.spawnNitroLoop}),this.accelerationTimeline=this.tweens.timeline({targets:this,delay:1e3,tweens:[{duration:v,ease:i.Math.Easing.Quadratic.InOut,props:{speed:{start:0,to:A}}}]}),this.tweens.add({targets:[this.containerTopCenter],ease:i.Math.Easing.Quadratic.Out,duration:1e3,delay:1e3,alpha:{start:0,to:1}}),this.allLoaded=!0,this.loadingOverlay.requestCompleted()},this.handleReflow=()=>{this.containerCentered.setScale(this.cameras.main.height/P),this.containerCentered.setPosition(this.cameras.main.centerX,this.cameras.main.centerY),this.containerTopCenter.setScale(this.cameras.main.height/P),this.containerTopCenter.setPosition(this.cameras.main.centerX,0),this.containerBottomCenter.setScale(this.cameras.main.height/P),this.containerBottomCenter.setPosition(this.cameras.main.centerX,this.cameras.main.height)},this.handleCollisions=()=>{if(this.isSafe)return;this.main3d.obstacles.active.filter(e=>i.Math.Distance.Between(e.position.x,e.position.z,this.main3d.player.position.x,this.main3d.player.position.z)<3).length<=0||(this.accelerationTimeline&&this.accelerationTimeline.isPlaying()&&this.accelerationTimeline.stop(),this.registry.set(r.playerStreak.ID,r.playerStreak.DEFAULT),this.registry.events.emit(d),this.accelerationTimeline=this.tweens.timeline({targets:this,tweens:[{duration:150,ease:i.Math.Easing.Quadratic.InOut,props:{speed:{from:this.speed,to:0}}},{duration:v,ease:i.Math.Easing.Quintic.In,props:{speed:{from:0,to:A}}}],onUpdate:()=>{this.registry.set(r.playerSpeed.ID,this.speed)}}))},this.handlePowerups=()=>{this.main3d.itemPoolMoney.active.filter(e=>i.Math.Distance.Between(e.position.x,e.position.z,this.main3d.player.position.x,this.main3d.player.position.z)<5).forEach(e=>{this.registry.events.emit(p,e)}),this.main3d.itemPoolNitro.active.filter(e=>i.Math.Distance.Between(e.position.x,e.position.z,this.main3d.player.position.x,this.main3d.player.position.z)<5).forEach(e=>{this.registry.events.emit(u,e)})},this.spawnObstacleLoop=()=>{for(let e=0,t=i.Math.Between(1,2);e<t;e++)this.main3d.obstacles.requestSpawn();this.time.delayedCall(i.Math.Between(Q,q),this.spawnObstacleLoop)},this.spawnNitroLoop=()=>{this.main3d.itemPoolNitro.requestSpawn(),this.time.delayedCall(i.Math.Between(j.RESPAWN_MIN,j.RESPAWN_MAX),this.spawnNitroLoop)},this.spawnMoneyLoop=()=>{for(let e=0,t=i.Math.Between(1,5);e<t;e++)this.main3d.itemPoolMoney.requestSpawn();this.time.delayedCall(i.Math.Between(Q,q),this.spawnMoneyLoop)},this.handleGameOver=()=>{this.scene.start(C.ID)},this.handlePickupNitro=()=>{const e=this.registry.get(r.playerStreak.ID)+1;this.registry.set(r.playerStreak.ID,e);const t=x*e;this.scoreFloaterPool.requestBurst(5*t,Ke.nitro),this.registry.events.emit(S,Z.nitro.id),this.accelerationTimeline&&this.accelerationTimeline.isPlaying()&&this.accelerationTimeline.stop(),this.accelerationTimeline=this.tweens.timeline({targets:this,tweens:[{duration:.4*O,ease:i.Math.Easing.Quadratic.InOut,props:{speed:{start:this.speed,to:_}}},{duration:.6*O,ease:i.Math.Easing.Quadratic.InOut,props:{speed:{from:_,to:A}}}]})},this.handlePickupMoney=()=>{const e=this.registry.get(r.playerStreak.ID)+1;this.registry.set(r.playerStreak.ID,e);const t=x*e;this.scoreFloaterPool.requestBurst(t),this.registry.events.emit(S,Z[`money${i.Math.Between(0,2)}`].id)},this.handleInputLeft=()=>{this.registry.events.emit(l)},this.handleInputRight=()=>{this.registry.events.emit(c)},this.requestShoot=()=>{console.log("TODO: pew pew")},this.requestJump=()=>{this.isJumping||(this.registry.events.emit(S,Z.jump.id),this.isJumping=!0,this.isSafe=!0,this.time.addEvent({delay:this.JUMP_SAFE_TIME,callback:()=>{this.isSafe=!1}}),this.jumpTimeline=this.tweens.timeline({targets:this.main3d.player.position,tweens:[{ease:i.Math.Easing.Quadratic.Out,duration:.4*this.JUMP_DURATION,props:{y:{from:this.main3d.player.position.y,to:this.main3d.player.position.y+this.JUMP_HEIGHT}}},{ease:i.Math.Easing.Bounce.Out,duration:.6*this.JUMP_DURATION,props:{y:{from:this.main3d.player.position.y+this.JUMP_HEIGHT,to:0}}}],onComplete:()=>{this.isJumping=!1}}))},this.handlePlayerCrashed=()=>{this.jumpTimeline&&!this.jumpTimeline.isPlaying()&&(this.jumpTimeline.stop(),this.registry.events.emit(S,Z[`crash${i.Math.Between(0,1)}`].id))}}create(){ae(this,o,this.handleReflow),this.loadingOverlay=new je(this),this.containerCentered=this.add.container(this.cameras.main.centerX,this.cameras.main.centerY,[this.loadingOverlay]),this.containerTopCenter=this.add.container(this.cameras.main.centerX,0),this.containerBottomCenter=this.add.container(this.cameras.main.centerX,this.cameras.main.height),this.containerTopCenter.alpha=0,this.main3d=new Qe(this),this.main3d.loadAssets().then(this.main3d.initScene).then(this.handleAllLoaded),this.handleReflow()}update(e,t){if(!this.allLoaded)return;this.score+=t*this.speed*M*(this.registry.get(r.playerStreak.ID)+1),this.registry.set(r.playerScore.ID,~~this.score),this.registry.set(r.playerSpeed.ID,this.speed),this.main3d.terrain.position.z=i.Math.Wrap(this.main3d.terrain.position.z+.3*t*this.speed,0,8e3),this.handleCollisions(),this.handlePowerups(),this.distance+=t,this.registry.set(r.playerDistance,this.distance);const s=this.registry.get(r.timeRemaining.ID)-t;if(s<=0)return this.registry.set(r.timeRemaining.ID,0),void this.handleGameOver();this.registry.set(r.timeRemaining.ID,s)}}class et extends i.GameObjects.Container{constructor(e,t=0,s=0){super(e,t,s),this.displayedScore=0,this.targetScore=0,this.targetScore=e.registry.get(r.playerScore.ID),this.scoreTitle=e.make.bitmapText({x:0,y:0,font:a.gotham_ultra_italic.ID,text:"CASH:",size:72,origin:.5}).setTint(16776960),this.scoreText=e.make.bitmapText({x:0,y:100,font:a.gotham_ultra_italic.ID,text:"0",size:100,origin:.5}),e.tweens.add({targets:this,duration:3e3,ease:i.Math.Easing.Quadratic.Out,displayedScore:{start:0,to:this.targetScore},onUpdate:()=>{this.scoreText.text=`$${(~~this.displayedScore).toLocaleString()}`}}),e.tweens.timeline({tweens:[{targets:this.scoreTitle,duration:1e3,ease:i.Math.Easing.Back.Out,props:{x:{start:-100,to:0}}},{offset:100,targets:this.scoreText,duration:1250,ease:i.Math.Easing.Back.Out,props:{x:{start:100,to:0}}}]}),e.tweens.add({targets:this,duration:500,ease:i.Math.Easing.Back.Out,scale:{start:.5,to:1}}),e.tweens.add({targets:this,duration:800,ease:i.Math.Easing.Quadratic.Out,alpha:{start:0,to:1}}),this.add([this.scoreTitle,this.scoreText])}}class tt extends i.Scene{constructor(){super({key:C.ID}),this.handlePlayClicked=(e,t)=>{this.registry.events.emit(b),this.registry.set(r.playerDistance.ID,r.playerDistance.DEFAULT),this.registry.set(r.timeRemaining.ID,r.timeRemaining.DEFAULT),this.registry.set(r.playerScore.ID,r.playerScore.DEFAULT),this.playButton.button.input.enabled=!1,this.scene.start(k.ID)},this.handleReflow=()=>{this.centeredContainer.setScale(this.cameras.main.height/P),this.centeredContainer.setPosition(this.cameras.main.centerX,this.cameras.main.centerY)}}create(){ae(this,o,this.handleReflow),this.background=new re(this,0,-.25*P),this.score=new et(this,0,.03*P),this.playButton=new he(this,0,.3*P),this.playButton.button.on(i.Input.Events.POINTER_UP,this.handlePlayClicked),this.centeredContainer=this.add.container(this.cameras.main.centerX,this.cameras.main.centerY,[this.background,this.score,this.playButton]),this.tweens.timeline({tweens:[{targets:this.background.flag,duration:500,ease:i.Math.Easing.Back.Out,props:{x:{start:100,to:0},alpha:{start:0,to:1}}},{offset:100,targets:this.background.title,duration:500,ease:i.Math.Easing.Back.Out,props:{x:{start:-100,to:0},alpha:{start:0,to:1}}},{offset:300,targets:this.playButton,duration:1e3,ease:i.Math.Easing.Quintic.Out,props:{y:{start:this.playButton.y+100,to:this.playButton.y},alpha:{start:0,to:1}}}]}),this.handleReflow()}}class st{constructor(e){this.scene=e,this.music={},this.sounds={},this.currentMusic=null,this.handleFocus=()=>{this.scene.sound.mute=this.scene.registry.get(r.audioMute.ID)},this.handleBlur=()=>{this.scene.sound.mute=!0},this.handleStopMusic=()=>{this.currentMusic&&this.currentMusic.stop&&this.currentMusic.stop()},this.requestMusic=e=>{for(let e in K)this.music[K[e].id].pause();this.currentMusic=this.music[e],requestAnimationFrame(()=>{this.music[e].rate=1,this.music[e].play({loop:!0})})},this.requestSound=e=>{this.sounds[e].play({seek:0})},this.handleMutedChanged=()=>{this.scene.sound.mute=this.scene.registry.get(r.audioMute.ID)};for(let t in K)this.music[K[t].id]=e.sound.add(K[t].id);for(let t in Z)this.sounds[Z[t].id]=e.sound.add(Z[t].id);ae(e,E,this.requestMusic),ae(e,S,this.requestSound),e.sound.mute="true"===localStorage.getItem(r.audioMute.ID),ne(e,r.audioMute.ID,this.handleMutedChanged),e.registry.set(r.music.ID,this.music),e.game.events.on(Phaser.Core.Events.FOCUS,this.handleFocus),e.game.events.on(Phaser.Core.Events.BLUR,this.handleBlur),ae(e,T,this.handleStopMusic)}}class it extends i.Scene{constructor(){super({key:U.ID}),this.resizeRequest=5,this.lastInnerHeight=0}create(){this.phaserCanvas=document.getElementById("phaser-canvas"),this.scale.on(i.Scale.Events.RESIZE,()=>{this.registry.events.emit(o),this.resizeRequest=5}),this.sound.mute=this.registry.get(r.audioMute.ID),this.sound.volume=this.registry.get(r.audioVolume.ID),this.audioManager=new st(this),this.registry.events.emit(E,K.intro.id),ne(this,r.audioVolume.ID,(e,t,s)=>{this.sound.volume=t,localStorage.setItem(r.audioVolume.ID,""+Phaser.Math.RoundTo(t,-2))}),ne(this,r.audioMute.ID,(e,t,s)=>{this.sound.mute=t,localStorage.setItem(r.audioMute.ID,""+t)})}update(){this.lastInnerHeight!==window.innerHeight&&(this.resizeRequest=5,this.lastInnerHeight=window.innerHeight),this.resizeRequest<=0||(this.resizeRequest--,window.scrollTo(1,0),this.registry.events.emit(o),this.phaserCanvas.style.left=`${.5*window.innerWidth-.5*this.phaserCanvas.width*(window.innerHeight/this.phaserCanvas.height)}px`,this.phaserCanvas.style.height=`${window.innerHeight}px`,this.scale.resize(window.innerWidth,window.innerHeight))}}class nt extends i.Game{constructor(){super({type:i.WEBGL,canvas:document.getElementById("phaser-canvas"),title:"AvatarLabs Racing Prototype",version:"0.0.1",autoFocus:!0,disableContextMenu:!0,width:D,height:P,render:{transparent:!0,clearBeforeRender:!0,powerPreference:"high-performance"},loader:{crossOrigin:"anonymous",async:!0},scale:{autoRound:!0,mode:i.Scale.ScaleModes.NONE},input:{activePointers:1},scene:[ee,se,oe,Ze,tt,it]}),this.events.on(Phaser.Core.Events.BLUR,()=>{this.scene.pause(k.ID)}),this.events.on(Phaser.Core.Events.FOCUS,()=>{this.scene.resume(k.ID)})}}new class{constructor(){new nt}}},752:function(e,t,s){var i=s(753),n=s(754);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);var a={insert:"head",singleton:!1},r=(i(n,a),n.locals?n.locals:{});e.exports=r},754:function(e,t,s){(t=s(755)(!1)).push([e.i,"html,\nbody {\n  width: 100vw;\n  height: 100vh;\n  background: black;\n}\n\nhtml, body, canvas {\n  overflow: hidden;\n  margin: 0;\n  padding: 0;\n  border: 0;\n  position: absolute;\n}\n\n#babylon-canvas,\n#phaser-canvas {\n  touch-action: none;\n}\n",""]),e.exports=t}},[[1673,3,2,1,4]]]);